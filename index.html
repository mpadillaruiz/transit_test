<!DOCTYPE html>
<html>
<head>

	<title>Quick Start - Leaflet</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
<link rel="stylesheet" href="markerstyle.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css" />

    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script>

</head>
<body>



<div id="mapid" style="width: 1300px; height: 600px;"></div>
<script>

	var mymap = L.map('mapid',{
        minZoom: 0,
        maxZoom: 25
    }).setView([40.7128, -74.0060], 9);
  var markers=[];

  L.tileLayer("http://tile.stamen.com/toner-background/{z}/{x}/{y}.png", {
        opacity: 0.1  }).addTo(mymap)

  L.tileLayer("http://tile.stamen.com/terrain-lines/{z}/{x}/{y}.png", {
        opacity: 0.8}).addTo(mymap)
  L.tileLayer("http://tile.stamen.com/toner-labels/{z}/{x}/{y}.png", {
        opacity: 0.5}).addTo(mymap)

var markersCluster = L.markerClusterGroup({
	spiderfyOnMaxZoom: false,
  disableClusteringAtZoom:15,
polygonOptions:{ weight: 3, color: '#222', opacity: 0.5 }
});


var url = "http://localhost:3000/stops"

$.ajax(url, {
      success: function(data) {
        for ( var i=0; i < data.length; ++i )
      {
        if(data[i].parent_station==""){
         var m = L.marker( [data[i].stop_lat, data[i].stop_lon] , {icon: greenIcon}).bindTooltip(data[i].stop_name,{direction:'top',permanent:false})
            .bindPopup( '<p>' + data[i].stop_id + '</p>' );
          markersCluster.addLayer(m);
      }
      mymap.addLayer(markersCluster);
      },
      error: function() {
         console.log("error");
      }
   });

   var greenIcon = L.icon({
       iconUrl: 'icon.png',


       iconSize:     [20, 20], // size of the icon
       //shadowSize:   [50, 64], // size of the shadow
       //iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
      // shadowAnchor: [4, 62],  // the same for the shadow
       popupAnchor:  [-5, -15] // point from which the popup should open relative to the iconAnchor
   });

</script>



</body>
</html>
